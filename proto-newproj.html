<!DOCTYPE html>
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com"> 
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@300&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/materialize.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <script src="https://jsuites.net/v4/jsuites.js"></script>
    <link rel="stylesheet" href="https://jsuites.net/v4/jsuites.css" type="text/css" />
    <link type="text/css" rel="stylesheet" href="styles/jquery.dropdown.min.css" />
    <script type="text/javascript" src="scripts/jquery.dropdown.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.3/font/bootstrap-icons.css">
    </head>
  <body>
    <nav>
      <div class="nav-wrapper">
        <a href="?page=logout" class="right" style="padding-right: 10px;">Logout</a>
        <ul id="nav-mobile" class="left">
          <li><a href="#" data-target="slide-out" class="sidenav-trigger show-on-small hide-on-med-and-up"><i class="material-icons large">menu</i></a></li>
          <li><a class="hide-on-small-only linkDashboard" href="#">Dashboard</a></li>
          <li><a class="hide-on-small-only linkCalendar" href="#">Calendar</a></li>
          <?php if ($account->permissions['timesheet']) {echo '<li><a class="hide-on-small-only linkPontaj" href="#">Ponteaza</a></li>';}?>
          <?php if ($account->permissions['holiday']) {echo '<li><a class="hide-on-small-only linkConcediu" href="#">Concediu</a></li>';}?>
          <?php if ($account->permissions['admin']) {echo '<li><a class="hide-on-small-only linkAdmin" href="/?page=admin">Admin</a></li>';}?>
        </ul>
      </div>
    </nav>

    <ul id="slide-out" class="sidenav">
      <div class="row">
        <h5 style="padding: 10px;">Buna <?php echo $account->getFirstName(); ?><a href="#" class="right" onclick="$('.sidenav').sidenav('close');"><i class="material-icons">close</i></a></h5>
        <br>
        <li><a href="#" class="linkDashboard">Dashboard</a></li>
              <li><a href="#" class="linkCalendar">Calendar</a></li>
              <?php if ($account->permissions['timesheet']) {echo '<li><a href="#" class="linkPontaj">Ponteaza</a></li>';}?>
              <?php if ($account->permissions['holiday']) {echo '<li><a href="#" class="linkConcediu">Concediu</a></li>';}?>
              <?php if ($account->permissions['admin']) {echo '<li><a href="/?page=admin" class="linkAdmin">Admin</a></li>';}?>
              <br>
        <li><a href="?page=logout">Logout</a></li>
      </div>
    </ul>

    <div class="row">
      <div class="col s12 m6 l6">
        <div class="card">
          <div class="card-content">
            <span class="card-title">Informatii de baza</span>
            <table class="centered">
              <tbody>
                <tr>
                  <td>Nume proiect</td>
                  <td class="center-align">
                    <div class="input-field" style="width: 280px; margin: auto;">
                      <input type="text" id="projName">
                    </div>
                  </td>
                </tr>
                <tr>
                  <td>Tip proiect</td>
                  <td><div id="projType"></div></td>
                </tr>
                <tr>
                  <td>Client</td>
                  <td><div id="projClient"></div></td>
                </tr>
                <tr>
                  <td>Proiect extern</td>
                  <td><label><input type="checkbox" class="filled-in" id="extern" /><span></span></label></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="col s12 m6 l6">
        <div class="card">
          <div class="card-content">
            <span class="card-title">Detalii proiect<div class="right"><span data-dropdown="#saveLoadMenu"><i class="bi bi-three-dots-vertical"></i></span></div></span>
            <table class="centered">
              <tbody id="detailsList">

              </tbody>
            </table>
            <table class="centered">
              <thead>
                <tr>
                  <td>Nume</td>
                  <td>Tip</td>
                  <td>Adauga</td>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <div class="input-field">
                    <input type="text" id="projDetailName">
                    </div>
                  </td>
                  <td><div id="addDetailType"></div></td>
                  <td><a class="waves-effect waves-light btn-small" onclick="addProjDetail();">Adauga detaliu</a></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="col s12 m6 l6">
        <div class="card">
          <div class="card-content">
            <span class="card-title">Faze Proiect</span>
            <p></p>
          </div>
        </div>
      </div>
      <div class="col s12 m6 l6">
        <div class="card">
          <div class="card-content">
            <span class="card-title">Milestones</span>
            <p></p>
          </div>
        </div>
      </div>
    </div>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script type="text/javascript" src="scripts/scripts.js"></script>
    <script>
      $(document).ready(function() {
        addLinks();
        $('.collapsible').collapsible();
        $('.modal').modal();
        $('.sidenav').sidenav();
        jSuites.picker(document.getElementById('addDetailType'), {
            data: ['Text scurt', 'Bifa', 'Text lung']});
        $.get("handler.php?r=init", function(data, status) {
          //console.log("Data: " + data + "\nStatus: " + status);
          initData = JSON.parse(data);
          clientsObject = initData.clients;
          //collabCatsObject = initData.collabCats;
          projCatsObject = initData.projCats;
          templates = initData.templates;
          let tmplData = new Array;
          var projCats = new Array;
          projCatsObject.forEach(element => {
            projCats.push({value: element.id, text: element.name});
          });
          jSuites.dropdown(document.getElementById('projType'), {
            data: projCats,
            onchange: function(element, index) {
              //idul selectat e Object.keys(index.value)[0];
            },
            width:'280px'});

          var projClients = new Array;
          clientsObject.forEach(element => {
            projClients.push({value: element.id, text: element.name});
          });
          /*jSuites.picker(document.getElementById('saveLoad'), {
          data: tmplData,
          content: 'more_vert',
          onchange: function(element, instance, reserved, value, key) {
            // This function will be called whenever the picker value is changed
            // As this is just an example, I will just print the new picker value on the console
            if (value=="Salveaza ca template") {
              let response = prompt("Introdu un nou nume:");
              if (typeof response === 'string') { response = response.trim(); }
              if (response == null || response == "" || saveTemplate.length < 1) {
                return 0;
              }
              var formData = {
                'action'  : 'saveTemplate',
                'name'    : response,
                'data'    : JSON.stringify(saveTemplate)
              };
              $.ajax({
                  url: 'handler.php',
                  type: 'POST',
                  encode: true,
                  //dataType: 'json',
                  data: formData,
                  success: function(idFromTheServer) {
                      if (idFromTheServer.substring(0,8) == "Success:") {
                        // Set the item id from the number sent by the remote server
                        //instance.setId(item, idFromTheServer.substring(8));
                        //templates.push({name: response, options: JSON.stringify(saveTemplate)});
                        tmplData.pop();
                        tmplData.push(response);
                        tmplData.push('Salveaza ca template');
                      }
                  },
                  error: function(errData) {
                    M.toast({html: errData});
                  }
              });
            } else {
              templates.forEach(elem => {
                if (elem.name == value) {
                  console.log(JSON.parse(elem.options));
                }
              })
              //load template
            }
          }
        });*/
          jSuites.dropdown(document.getElementById('projClient'), {
            data: projClients,
            newOptions: true,
            autocomplete: true,
            lazyLoading: true,
            onchange: function(element, index) {
              //idul selectat e Object.keys(index.value)[0];
            },
            oninsert: function(instance, item) {
              if (item.text == null || item.text.trim() == '') return 0;
              var formData = {
                'action'            : 'addToDB',
                'type'              : 'addClient',
                'name'              : item.text.trim()
              };
              $.ajax({
                  url: 'handler.php',
                  type: 'POST',
                  encode: true,
                  //dataType: 'json',
                  data: formData,
                  success: function(idFromTheServer) {
                      if (idFromTheServer.substring(0,8) == "Success:") {
                        // Set the item id from the number sent by the remote server
                        instance.setId(item, idFromTheServer.substring(8));
                        clientsObject.push({id: idFromTheServer.substring(8), name: item.text.trim()});
                      }
                  },
                  error: function(errData) {
                    M.toast({html: errData});
                  }
              });
            },
            width:'280px',
        });
        });
      })
    </script>
    <?php if ($account->permissions['timesheet']) {echo '<script>addPontajButton=1;</script>';} else {echo '<script>addPontajButton=0;</script>';}?>
    <div id="saveLoadMenu" class="dropdown dropdown-tip">
      <ul class="dropdown-menu" id="saveLoadMenuItems">
          <li><a href="#1">Item 1</a></li>
          <li><a href="#2">Item 2</a></li>
          <li><a href="#3">Item 3</a></li>
          <li class="dropdown-divider"></li>
          <li><a href="#4">Item 4</a></li>
          <li><a href="#5">Item 5</a></li>
          <li><a href="#5">Item 6</a></li>
      </ul>
  </div>
  </body>
</html>
      